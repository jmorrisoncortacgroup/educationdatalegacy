{
	"name": "transform AP",
	"properties": {
		"content": {
			"query": "SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROC [transform].[sp_AcademicPerformance] AS \nbegin\nIF EXISTS (\n    SELECT 1\n    FROM sys.tables\n    WHERE name = 'AcademicPerformance' AND schema_id = SCHEMA_ID('transform')\n)\nBEGIN\n    EXEC('DROP TABLE transform.AcademicPerformance')\nEND;\n\nUPDATE [staging].[AcademicPerformance] SET [Count of Students Expected to Test] = NULL WHERE [Count of Students Expected to Test] = NULL;\nUPDATE [staging].[AcademicPerformance] SET [CountMetStandard] = NULL WHERE [CountMetStandard] = NULL;\nUPDATE [staging].[AcademicPerformance] SET [CountofStudentsExpectedtoTest(including previously passed)] = NULL WHERE [CountofStudentsExpectedtoTest(including previously passed)] = NULL;\nUPDATE [staging].[AcademicPerformance] SET [PercentMetStandard] = NULL WHERE [PercentMetStandard] = 'NULL';\n\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [SchoolYear] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [OrganizationLevel] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [County] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [ESDName] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [ESDOrganizationID] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [DistrictCode] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [DistrictName] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [DistrictOrganizationId] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [SchoolCode] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [SchoolName] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [SchoolOrganizationid] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [CurrentSchoolType] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [StudentGroupType] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [StudentGroup] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [GradeLevel] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [TestAdministration] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [TestSubject] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [Suppression] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [Count of Students Expected to Test] int NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [CountMetStandard] int NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [CountofStudentsExpectedtoTest(including previously passed)] int NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentMetStandard] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentLevel1] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentLevel2] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentLevel3] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentLevel4] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentMetTestedOnly] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentNoScore] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [DataAsOf] NVARCHAR(255) NULL;\nALTER TABLE [staging].[AcademicPerformance] ALTER COLUMN [PercentParticipation] NVARCHAR(255) NULL;\n\n\n\nSELECT [SchoolYear]\n      ,[OrganizationLevel]\n      ,[County]\n      ,[ESDName]\n      ,[ESDOrganizationID]\n      ,[DistrictOrganizationId]\n      ,[SchoolCode]\n      ,[SchoolOrganizationid]\n      ,[CurrentSchoolType]\n      ,[StudentGroupType]\n      ,[StudentGroup]\n      ,[GradeLevel]\n      ,[TestAdministration]\n      ,[TestSubject]\n      ,[Suppression]\n      ,[Count of Students Expected to Test]\n      ,[CountMetStandard]\n      ,[CountofStudentsExpectedtoTest(including previously passed)]\n      ,[PercentMetStandard]\n      ,[DataAsOf]\n    ,coalesce(b.[School Name], a.[SchoolName]) as [SchoolName]\n    ,coalesce(b.[Home District Code], case when len([DistrictCode])<5 \n    then '0' + [DistrictCode] -- add 0 in front if the distictcode has four digit\n    else [DistrictCode] \n    end) as [DistrictCode],\n    coalesce([Home District], [DistrictName]) as [DistrictName]\ninto transform.AcademicPerformance\nFROM [staging].[AcademicPerformance] a\n  left join [staging].[CharterSchoolDirectory] b \n  on a.[SchoolCode] = b.[School Code]\n\nEND\nGO\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "GatesDedicatedSql",
				"poolName": "GatesDedicatedSql"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}