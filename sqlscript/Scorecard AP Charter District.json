{
	"name": "Scorecard AP Charter District",
	"properties": {
		"content": {
			"query": "ORIGINAL [scorecard].[sp_AcademicPerformanceCharterDistrict]\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER PROC [scorecard].[sp_AcademicPerformanceCharterDistrict] AS\nBegin\n\nIF EXISTS (\n    SELECT 1\n    FROM sys.tables\n    WHERE name = 'AcademicPerformanceCharterDistrict' AND schema_id = SCHEMA_ID('scorecard')\n)\nBEGIN\n    EXEC('DROP TABLE scorecard.AcademicPerformanceCharterDistrict')\nEND;\n\n\nwith cte as (\n\nSELECT  distinct b.[SchoolYear]\n      ,b.[OrganizationLevel]\n      ,b.[County]\n      ,b.[ESDName]\n      ,b.[ESDOrganizationID]\n      ,b.[DistrictOrganizationId]\n      ,b.[DistrictCode]\n      ,b.[DistrictName]\n      ,[Charter District]\n      ,b.[SchoolOrganizationid]\n      ,b.[CurrentSchoolType]\n      ,b.[StudentGroupType]\n      ,b.[StudentGroupCategory]\n      ,b.[StudentGroup]\n      ,'All Grades' as [GradeLevel]\n      ,b.[TestAdministration]\n      ,b.[TestSubject]\n      ,[CountMetStandard District]\n      ,[CountofStudentsExpectedtoTest(including previously passed) District]\n      ,[PercentMetStandard District]\n      ,[PercentMet District]\nFROM  [transform].[AcademicPerformanceSchool] a\nJOIN  [transform].[AcademicPerformanceDistrict] b ON a.DistrictCode = b.DistrictCode \n      AND a.SchoolYear = b.SchoolYear\n      AND a.StudentGroup = b.StudentGroup \n      AND a.TestAdministration = b.TestAdministration\n      AND a.TestSubject = b.TestSubject\n      and a.[GradeLevel] = b.[GradeLevel]\n      and b.[GradeLevel] <> 'All Grades'\n      and a.[Charter School] = 'Yes'\n\n)\nselect \n         [SchoolYear]\n         ,[OrganizationLevel]\n         ,[County]\n         ,[ESDName]\n         ,[ESDOrganizationID]\n         ,[DistrictOrganizationId]\n         ,[DistrictCode]\n         ,[DistrictName]\n         ,[Charter District]\n         ,[SchoolOrganizationid]\n         ,[CurrentSchoolType]\n         ,[StudentGroupType]\n         ,[StudentGroupCategory]\n         ,[StudentGroup]\n         ,[GradeLevel]\n         ,[TestAdministration]\n         ,[TestSubject]\n         ,SUM([CountMetStandard District]) AS [CountMetStandard District]\n         ,SUM([CountofStudentsExpectedtoTest(including previously passed) District]) AS [CountofStudentsExpectedtoTest(including previously passed) District]\n         ,AVG([PercentMetStandard District]) AS [PercentMetStandard District]\n         ,CAST(SUM([CountMetStandard District]) AS FLOAT) / SUM([CountofStudentsExpectedtoTest(including previously passed) District]) AS [PercentMet District]\nInto scorecard.AcademicPerformanceCharterDistrict\nfrom cte\nGROUP BY [SchoolYear]\n         ,[OrganizationLevel]\n         ,[County]\n         ,[ESDName]\n         ,[ESDOrganizationID]\n         ,[DistrictOrganizationId]\n         ,[DistrictCode]\n         ,[DistrictName]\n         ,[Charter District]\n         ,[SchoolOrganizationid]\n         ,[CurrentSchoolType]\n         ,[StudentGroupType]\n         ,[StudentGroupCategory]\n         ,[StudentGroup]\n         ,[GradeLevel]\n         ,[TestAdministration]\n         ,[TestSubject]\n\nUnion\n\nSelect Distinct b.[SchoolYear],\n    a.[OrganizationLevel],\n    a.[County],\n    a.[ESDName],\n    a.[ESDOrganizationID],\n    a.[DistrictOrganizationId],\n    a.[DistrictCode],\n    a.[DistrictName],\n    a.[Charter District],\n    a.[SchoolOrganizationid],\n    a.[CurrentSchoolType],\n    a.[StudentGroupType],\n    a.[StudentGroupCategory],\n    a.[StudentGroup],\n    a.[GradeLevel],\n    a.[TestAdministration],\n    a.[TestSubject],\n    a.[CountMetStandard District],\n    a.[CountofStudentsExpectedtoTest(including previously passed) District],\n    a.[PercentMetStandard District],\n    a.[PercentMet District]\nfrom [transform].[AcademicPerformanceDistrict] a\nJOIN [transform].[AcademicPerformanceSchool] b on a.DistrictCode = b.DistrictCode \n      AND a.SchoolYear = b.SchoolYear\n      AND a.StudentGroup = b.StudentGroup \n      AND a.TestAdministration = b.TestAdministration\n      AND a.TestSubject = b.TestSubject\n      and a.[GradeLevel] = b.[GradeLevel]\n     and [Charter School] = 'Yes'\n     and a.[GradeLevel] <> 'All Grades'\n\nEND\n\n\n\nGO\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "GatesDedicatedSql",
				"poolName": "GatesDedicatedSql"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}