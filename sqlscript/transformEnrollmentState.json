{
	"name": "transformEnrollmentState",
	"properties": {
		"folder": {
			"name": "Tables"
		},
		"content": {
			"query": "\n-- query for State level enrollment\n\n\nIF EXISTS (\n    SELECT 1\n    FROM sys.tables\n    WHERE name = 'EnrollmentState' AND schema_id = SCHEMA_ID('transform')\n)\nBEGIN\n    EXEC('DROP TABLE transform.EnrollmentState')\nEND\n\n\nSELECT [SchoolYear]\n      ,[OrganizationLevel]\n      ,[County]\n      ,[ESDName]\n      ,[DistrictName]\n      ,[SchoolName]\n      ,b.[GradeLevel]\n\t  ,unpvt.[StudentGroup] as SG\n      ,c.[StudentGroup]\n\t  ,[StudentGroupCategory]\n      ,[StudentGroupType]\n\t  ,[Enrollment]\n      ,[DataAsOf]\nInto transform.EnrollmentState\nFROM (\n    SELECT [SchoolYear]\n          ,[OrganizationLevel]\n          ,[County]\n          ,[ESDName]\n          ,[ESDOrganizationID]\n          ,[DistrictCode]\n          ,[DistrictName]\n          ,[DistrictOrganizationId]\n          ,[SchoolCode]\n          ,[SchoolName]\n          ,[SchoolOrganizationid]\n          ,[CurrentSchoolType]\n          ,[GradeLevel]\n          ,[All Students]\n          ,[Female]\n          ,[Male]\n          ,[Gender X]\n          ,[American Indian/ Alaskan Native]\n          ,[Asian]\n          ,[Black/ African American]\n          ,[Hispanic/ Latino of any race(s)]\n          ,[Native Hawaiian/ Other Pacific Islander]\n          ,[Two or More Races]\n          ,[White]\n          ,[English Language Learners]\n          ,[Highly Capable]\n          ,[Homeless]\n          ,[Low-Income]\n          ,[Migrant]\n          ,[Military Parent]\n          ,[Mobile]\n          ,[Section 504]\n          ,[Students with Disabilities]\n\t      ,[Foster Care]\n\t      ,[DataAsOf]\n    FROM [staging].[Enrollment]\n    WHERE [OrganizationLevel] = 'State'\n) AS a\nUNPIVOT (\n    [Enrollment] FOR [StudentGroup] IN (\n        [All Students],\n        [Female],\n        [Male],\n        [Gender X],\n        [American Indian/ Alaskan Native],\n        [Asian],\n        [Black/ African American],\n        [Hispanic/ Latino of any race(s)],\n        [Native Hawaiian/ Other Pacific Islander],\n        [Two or More Races],\n        [White],\n        [English Language Learners],\n        [Highly Capable],\n        [Homeless],\n        [Low-Income],\n        [Migrant],\n        [Military Parent],\n        [Mobile],\n        [Section 504],\n        [Students with Disabilities],\n\t    [Foster Care]\n    )\n) AS unpvt\nLEFT JOIN dim.GradeLevel b ON unpvt.GradeLevel = b.GradeLevelKey\nLEFT JOIN [dim].[StudentGroup] c ON unpvt.StudentGroup = c.StudentGroupKey\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "master",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}